Introduction Cancer is one of the most widespread illnesses in the world, responsible for millions of death every year with increasing numbers over time 1 . Bladder Cancer (BC) is the seventh most common cancer worldwide, associated with 400 thousand new cases and 150 thousand deaths every year as of 2018 2 and 600 thousand yearly new cases worldwide with only 77% five-year survival rate as of 2022 (We refer the interested reader to the full updated statistics at https://www.cancer.net ). BC has many forms and clinical stages, mainly differing by the depth of the cancer cell population in the urothelium 3 . In the scope of this study, we focus on the non-invasive (superficial) BC where the cancer cells do not spread beyond the inner layer of the bladder where the entire cancer cell population is located inside the urothelium and does not invade other tissues. The non-invasive BC is highly common with roughly four out of five of all BC cases being diagnosed at the non-invasive stage 4 . In these cases, multiple treatment protocols exist including chemotherapy-based 5 and immunotherapy-based 6 treatments. Currently, the immunotherapy treatment suggested by Morales et al. 7 that follows weekly injections of Bacillus Calmette-Gérin (BCG) seems to achieve the best clinical improvement over a broad spectrum of clinical states 8 , 9 . Most notably, BCG-based immunotherapy treatment has proven to reduce both the recurrence and progression of BC 10 . The BCG treatment protocol is defined by the amount of the injected dosage, the number of injections, and the schedule of the treatment 11 . Any change in one or more of these configurations can have a drastic effect on the patient’s clinical state. However, due to the complexity of the biological dynamics, it is challenging to predict this change in advance. In order to derive a suitable treatment protocol for patients, either at the individual or group level, researchers and clinicians often leverage the power of mathematical models and simulation 12 , 13 , 14 . Commonly, in silico experiments provide a cheap, quick, and humane solution for clinical investigation of treatment protocols, allowing one to better understand and capture the underlying pharmacokinetics and pharmacodynamics 15 , 16 . These models and simulations typically rely on an ordinary differential equation (ODE) representation where each variable describes a different cell population size 17 , 18 , 19 , 20 , 21 . Indeed, the modeling and simulation of BC treatment protocols using this approach have attracted much attention in the literature 22 , 23 , 24 . Notably, Bunimovich-Mendrazitsky et al. 25 proposed a BCG-based treatment protocol for BC which assumed continuous BCG instillation with a logistic growth for cancer cells inside the bladder. Formally, the proposed model takes the form: $$\begin{aligned} \frac{dB(t)}{dt}&= -p_1E(t)B(t) - p_2B(t)T_u (t) - \mu _1 B(t) + b \end{aligned}$$ (1) $$\begin{aligned} \frac{dE(t)}{dt}&= -\mu _2E(t) + \alpha T_i (t) + p_4 E(t)B(t) - p_5(t) E(t) T_i (t) \end{aligned}$$ (2) $$\begin{aligned} \frac{dT_i (t)}{dt}&= p_2 B(t)T_u (t) - p_3 T_i (t) E(t) \end{aligned}$$ (3) $$\begin{aligned} \frac{dT_u (t)}{dt}&= \lambda (t) T_u (t) - p_2 B(t)T_u (t), \end{aligned}$$ (4) where \(B(t)\) , \(E(t)\) , \(T_i (t)\) , and \(T_u (t)\) represent the concentration of BCG in the bladder, effector cell population size, the population of cancer cell that has been infected with BCG size, and the population of cancer cell that is uninfected with BCG size, respectively. The model’s parameters represent the following quantities: \(p_1\) is the rate of BCG killed by effector cells; \(p_2\) is the infection rate of uninfected cancer cells by BCG; \(p_3\) is the rate of destruction of cancer cell infected by BCG by effector cells; \(p_4\) is the immune response activation rate; \(p_5\) is the rate of effector cells deactivation after binding with infected cancer cells. \(\alpha \) is the growth rate of effector cell population; \(\lambda \) is the cancer’s population growing rate; \(b\) is the amount of BCG injected to the bladder. Figure 1 shows a schematic view of this model, including the different cell populations and the interactions between them. Figure 1 Cell population dynamics in the bladder—taken with permission from Bunimovich-Mendrazitsky et al. 25 . BCG ( \(B\) ) stimulates effector cells ( \(E\) ) of the immune system via APC activation. In addition, BCG infects uninfected cancer cells ( \(T_u\) ) which recruit effector cells into the bladder. Infected cancer cells ( \(T_i\) ) are destroyed by effector cells. Full size image One promising avenue for improving BCG-based treatment protocols is changing the currently practiced “one-size-fits-all” approach with a more personalized one 26 , 27 . Specifically, by taking social and behavioral factors into account, one is likely to obtain a more favorable treatment prediction model at the individual patient’s level and lead to better clinical outcomes as treatment optimization models would be able to have an underlined more accurate outcome prediction model 28 . A patient’s social and behavioral characteristics can be typically extracted with minimal overhead (e.g., by a simple questioning or directly from the patient’s electronic health record) as opposed to alternative information-gathering efforts such as additional clinical tests which are associated with substantial operational costs. Following this line of thought, in this work, we propose a novel mathematical model which significantly extends that of Bunimovich-Mendrazitsky et al. 25 . Our novelty lies primarily in the integration of a machine learning component which is used to assess and adjust the model’s parameters over individuals and over time. Using real-world data of \(N=417\) patients, we show that our model favorably compares to the existing models. Mathematical modeling Our model consists of two interconnected modules: a BCG-based treatment module and a socio-demographic personalization module. First, we define the bio-clinical dynamics of BCG treatment for BC. Then, we formalize the socio-demographics that underline the BCG-treatment dynamics. Based on these two modules, we formulate a fitting procedure to set the parameters of an instance of the framework using historical data. Figure 2 shows a schematic view of the mathematical modeling. Figure 2 A schematic view of the mathematical modeling. Full size image BCG-based treatment module Our following mathematical formulation relies on extensive prior literature which proposed and analyzed several biological models to describe the biological process underlying the BCG-based immunotherapy treatment for BC with increasing levels of complexity, capturing biological and clinical properties with great levels of detail and, presumably, accuracy 22 , 29 , 30 , 31 , 32 , 33 . These and similar models describe, in a mathematical manner, the change in several cell populations over time due to (spatio-)temporal interaction between these cell populations 34 , 35 , 36 . Generally speaking, the main line of work for modeling BCG-based treatment for BC, which we also follow in this work, was proposed by 23 . The authors used a system of ODEs that represents the cell population sizes of several cell types over time. In particular, they divide the cell population into three main groups: BCG-infected, cancer, and immune-related cells, and described their interaction. In addition, special attention was placed on the distinction between BCG-infected and non-BCG-infected cells. Here, we extend the model proposed by Bunimovich-Mendrazitsky et al. 25 in three manners: First, we replace the continuous BCG injection which assumes BCG is injected at some rate at any point in time with a discrete one which assumes a set of points in time in which BCG is injected. The latter more closely describes how BCG administration is provided in practice 23 ; Second, we consider the uninfected cancer cell elimination by immune system cells 37 ; Third, we introduce a healthy cell population and its interactions with the other cell types during a BCG treatment 27 . Importantly, following 38 ’s work, we assume that the BCG interaction with healthy and cancer cells is different following the difference between the cells’ surfaces as well as shape. In addition, in order to allow personalization within the model, we replace the scalar parameters with functions that depend on time and the socio-demographics of the patient and add a term to the immune cells population that is associated with the presence of immune cells based on the level of the patient’s activeness. Hence, the model takes the form (and explained right after): $$\begin{aligned} \frac{dB(t)}{dt}&= \sum _{m=0}^{N-1}b\delta (t-m\tau ) - p_1(t)E(t)B(t) - p_2(t)B(t)T_u (t) - p_8(t)B(t)H_u (t) - \mu _B B(t). \end{aligned}$$ (5) $$\begin{aligned} \frac{dE(t)}{dt}&= -\mu _E(t) E(t) + \alpha \big ( T_i (t) + H_i (t) \big ) + p_4(t) E(t)B(t) - p_5(t) E(t) T_i (t) - p_6(t) E(t) H_i (t). \end{aligned}$$ (6) $$\begin{aligned} \frac{dT_i (t)}{dt}&= p_2(t) B(t)T_u (t) - p_3(t) T_i (t) E(t). \end{aligned}$$ (7) $$\begin{aligned} \frac{dT_u (t)}{dt}&= \lambda (t) T_u (t) - p_2(t) B(t)T_u (t) -p_3(t)T_u(t)E(t). \end{aligned}$$ (8) $$\begin{aligned} \frac{dH_u (t)}{dt}&= p_7(t)H_u(t) \left( 1 - \frac{H_u(t) + H_i(t) + T_u(t) + T_i(t)}{H_m} \right) - p_8(t) B(t) H_u(t). \end{aligned}$$ (9) $$\begin{aligned} \frac{dH_i (t)}{dt}&= p_8(t) B(t) H_u(t) - p_9(t)E(t)H_i(t). \end{aligned}$$ (10) In Eq. ( 5 ), \(\frac{dB(t)}{dt}\) is the dynamic change of BCG in the bladder over time. It is affected by the following five terms. First, a quantity \(b\) of BCG has been instilled into the bladder every \( \tau \) steps in time. As the instillation of the BCG is modeled by a shifted Dirac delta function \(\delta (t - m \tau ), m \in \{0, \ldots , N - 1\}\) , the \(m_{th}\) dose raises \(B(t)\) by \(b\) units at time \(t = m \tau \) . To be exact, we define the \(\delta \) function as the \(\varepsilon \) -approximation of the Dirac delta function in which the function has positive values in the range \([-\varepsilon , \varepsilon ]\) and the function linearly increase and decrease between \([-\varepsilon , 0]\) and \([0, \varepsilon ]\) while satisfying an integral value of 1. Second, BCG is eliminated by the immune cells (APCs) at a rate \(p_1(t)\) . Third and Fourth, BCG penetrates into uninfected cancer and uninfected healthy cells and is removed from the volume of the bladder while converting these cells into BCG-infected cancer cells at rates \(p_2(t)\) and \(p_8(t)\) , respectively. Finally, the BCG cell population naturally decays at a rate \( \mu _B \) . In Eq. ( 6 ), \(\frac{dE(t)}{dt}\) is the dynamic number of immune cells over time. It is affected by the following five terms. First, the immune cell population naturally decays at a rate \( \mu _E(t) \) . Second, immune cells are recruited due to the detection of BCG-infected cancer and healthy cells at a rate \(\alpha (t)\) . Third, immune cells are recruited due to bacterial infection in the bladder at a rate \(p_4(t)\) . Fourth and fifth, immune cells are destroyed while eliminating BCG-infected cancer and regular cells at rates \(p_5\) and \(p_6\) , respectively. In Eq. ( 7 ), \(\frac{dT_i(t)}{dt}\) is the dynamic number of BCG-infected cancer cells over time. It is affected by the following two terms. First, BCG-infected cancer cells generated from uninfected cancer cells that interacted with BCG at a rate \(p_2(t)\) . Second, BCG-infected cancer cells are eliminated by immune cells at a rate \(p_3(t)\) . In Eq. ( 8 ), \(\frac{dT_u(t)}{dt}\) is the dynamic number of uninfected cancer cells over time. It is affected by the following three terms. First, uninfected cancer cells naturally grow at a rate \(\lambda \) . Second, uninfected cancer cells become BCG-infected and are eliminated by immune cells at a rate \(p_2(t)\) . Third, immune system cells eliminate uninfected cancer cells at a rate \(p_3\) . In Eq. ( 9 ), \(\frac{dH_u(t)}{dt}\) is the dynamic number of uninfected healthy cells over time. It is affected by the following two terms. First, healthy cells are generated to fulfill the volume of the bladder, \(H_m\) , at a rate \(p_7(t)\) . Second, uninfected healthy cells become BCG-infected due to the presence of BCG at a rate \(p_8(t)\) . In Eq. ( 10 ), \(\frac{dH_i(t)}{dt}\) is the dynamic number of BCG-infected healthy cells over time. It is affected by the following two terms. First, uninfected healthy cells generated from uninfected cancer cells that interacted with BCG at a rate \(p_8(t)\) . Second, BCG-infected healthy cells are eliminated by immune cells at a rate \(p_9(t)\) . For the proposed model, the initial condition at the beginning of the BCG treatment takes the form: $$\begin{aligned} B(0) = 0, E(0) = e> 0, T_i(0) = 0, T_u(0) = T_0 > 0, H_u(0) = H_m - T_0, H_i(0) = 0. \end{aligned}$$ (11) A theoretical analysis of the model, proving that it is well-posed and analyzing its equilibria states and their stability, is provided in section “ Theoretical Analysis ”. Socio-economic parameters Patients are categorized into one of \(72\) socio-demographic groups. These groups are constructed based on the Cartesian product of four discretized properties: age (19–25, 26–35, 36–45, 46–55, 56–65, and 66+), gender (male and female), smocking behavior (smoker and non-smoker), and weight (underweight, normal weight, and over-weight) such that the groups are pairwise disjoint. We decided on this democratization as it is commonly used in clinical studies and would be utilized later in this study as well 39 , 40 , 41 , 42 . That said, the model is agnostic to the democratization of these parameters. Formally, each patient is represented by a timed finite state machine 43 as follows: \(p := (a, g, s, w)\) where \(a\) is the age group, \(g\) is the gender group, \(s\) is the smoking group, and \(w\) is the weight group. Importantly, it is assumed that a patient’s socio-demographic properties do not change over the treatment process. Treatment model fitting Any model is as accurate as its fitting procedure allows. Thus, one may need to fit the proposed model on historical clinical data, obtaining a good approximation of the model’s parameters’ values. For the proposed model and in the clinical context it occurs, the historical data commonly have several limitations that make it challenging in the best case and infeasible in the worst case to use. Specifically, the BCG treatment data generally focuses on the treatment’s clinical outcome and rarely, if any, include the cell population sizes ( \(E, T_i, T_u, H_i,\) and \(H_u\) ) during the time of the treatment. As such, only two sample points during the course of the treatment are typically available - one at the beginning of the treatment and another one at its end. Second, the socio-demographic data is not directly taken into consideration in the model. However, it is correlated with the model’s parameters. Third, the amount of available data is relatively small (usually, several hundred samples). Following the first point, and since measuring the amount of cancer cells is both clinically challenging and expensive, we assume that the data takes the form of \(T_i(0) + T_u(0), T_i(t_f) + T_u(t_f), \zeta \) where \(t_f \in \mathbb {N}\) is the time at the end of the treatment and \(\zeta \in \mathbb {R}^x\) is a vector of the socio-demographic properties of the patient such that \(x \in \mathbb {N}\) is the number of socio-demographic properties. During the fitting procedure, one is typically required to work with only the beginning and end points of the model which themselves only provide partial knowledge of the model’s state (i.e., \(T_u\) and \(T_i\) without \(B, E, H_u, H_m\) ). Hence, traditional fitting procedures might obtain unrealistic courses between these two points as long as the model closely crosses near them. To tackle this challenge, we proposed a three-step fitting procedure where each step is responsible for improving the accuracy and robustness of the model. The procedure begins with dividing the data into \(k\) cohorts following the classic \(k\) -fold cross-validation method 44 . This step is common in machine learning practices and improves the procedure’s robustness 44 . Then, each cohort is further divided into train, test, and validate sets. Using only the train set, we adopt the fitting procedure proposed in 45 which, given the model’s initial condition, the parameter space, historical data, and a loss function \(d\) , utilizes a gradient descent (GD) method 46 to find the parameters that minimize \(d\) on a fixed and finite duration in time \([t_0, t_f]\) such that \(t_0 < t_f\) . Notably, the GD is applied on the model’s parameters space such that the gradient for each configuration of parameter values is numerically obtained using the five-point stencil numerical scheme 47 . The result of this process is the model’s parameters’ values that result in the closest clinical outcome of the given train set, divided into the socio-economic groups presented in the data. This step is shown to provide efficient initial fitting of the model’s parameters 45 . Nonetheless, due to the limited number of samples in the data, the space of parameter values and initial conditions is presumably properly covered which highly limits the usefulness of this method alone 48 . To overcome this limitation, following similar sample-generating methods 49 , 50 , at the second step of our procedure, we augment our training set by randomly generating new synthetic samples such that their feature values are drawn from a uniform distribution that ranges between the minimum and maximum of the values in the train set. Once a synthetic sample is generated, it is added to the train set if and only if the error in the model’s prediction of the clinical outcome for this synthetic sample is lower than the one obtained from an optimized \(k\) nearest neighbor (KNN) algorithm 51 , 52 . This step is repeated until \(n \in \mathbb {N}\) synthetic samples are added to the train set. The resulting augmented training set is then reintroduced to the first step of the fitting procedure as discussed above. Using the test set, we examine whether the augmented training set brings about statistically significantly better predictions than the original one. If not, we repeat the second step once more. Otherwise, we combine the augmented training set and the test set to be used by the third and final step of our procedure. Finally, in order to bolster the robustness of the fitting procedure, we perform an extrapolation over the parameter space using the utilization of a machine-learning framework. Specifically, we use the Tree-based Pipeline Optimization Tool (TPOT) 53 automatic machine learning framework to search a large number of machine learning pipelines such that, for each pipeline, we test its performance on the validation set. Specifically, a machine learning pipeline obtains the input of the model and returns the model’s parameters’ values that minimize the error in the prediction, based on the samples from the previous steps. The machine learning pipeline with the best performance, given a pre-defined metric \((M)\) , is chosen. This process is performed for each \(i \in [1, \ldots , k]\) fold. The consequent prediction is defined to be the average across the best-performing machine learning pipelines across all folds. Overall, Fig. 3 provides a schematic view of the proposed fitting method and summarizes its main steps. Figure 3 A schematic view of the proposed fitting procedure. Full size image Ethical statement Since this work performs only in silico experiments based on previously published data, ethical approval is waived. Theoretical analysis Here, we theoretically analyze the proposed model (Eq. 5 – 10 ). We start by proving that the model always has a unique solution. Then, we identify the model’s equilibria and analyze their stability. Solution existence and uniqueness In order to show that the proposed model has a solution and it is unique, we utilize the Picard–Lindelöf theorem 54 . Formally, the Picard–Lindelöf theorem states that if \(D \subset \mathbb {R} \times \mathbb {R}^n\) is a closed rectangle with \((t_0, y_0) \in D\) and \(f: D \rightarrow \mathbb {R}^n\) is a function that is continuous in \(t\) and Lipschitz continuous in \(y\) ; then there exists some \(\varepsilon > 0\) such that the initial value problem: $$\begin{aligned} y'(t) = f(t, y(t)), y(t_0) = y_0, \end{aligned}$$ (12) has a unique solution \(y(t)\) on the interval \([t_0 - \varepsilon , t_0 + \varepsilon ]\) . Thus, for our case \(y(t) := (B(t), E(t), T_i(t), T_u(t), H_u(t), H_i(t))\) . In order to use the Picard–Lindelöf theorem, we first need to show that Eqs. ( 5 – 10 ) is continuous in \(t\) and Lipschitz continuous in \(y\) . To this end, let us consider a finite duration in time \([0, T]\) such that \(T < \infty \) . Next, the interaction between the of the unknown solution, \(y\) , has terms of a linear form and of the form \(y_i y_j\) , the function \(f\) such that \(dy(t)/dt = f(t, y(t))\) is \(C^1\) which implies that it also locally satisfies Lipschitz condition and continuous in \(t\) 55 . Therefore, one can apply the Cauchy-Lipschitz theorem 56 which leads to the result of the existence and uniqueness of the solution to Eq. ( 5 – 10 ), on any finite interval \([0,T]\) . Hence, we show that a solution exists. As such, we need to show that for any non-negative initial condition, the solution is non-negative. To this end, let us assume a non-negative initial condition \((B(0) \ge 0, E(0) \ge 0, T_i(0) \ge 0, T_u(0) \ge 0, H_i(0) \ge 0, H_u(0) \ge 0)\) for the proposed model (Eq. ( 5 – 10 )). Now, let us focus on the fourth equation. By dividing by \(T_u(t)\) , one obtains: $$\begin{aligned} T_u'(t)/T_u(t) = \lambda - p_2(t)B(t) - p_3(t)E(t). \end{aligned}$$ (13) Computing the integral for \(t\) , we obtain that: $$\begin{aligned} T_u(t) = e^{\int (\lambda - p_2(t)B(t) - p_3(t)E(t))dt}T_u(0), \end{aligned}$$ (14) Since \(T_u(0) \ge 0\) , we obtain \(T_u(t) \ge 0\) for any value of \(t\) . For the fifth equation, we have a second-order equation in \(H_u(t)\) . Namely, for \(H_u(t)\) the fifth equation is a Riccati equation, and therefore the solution of the equations takes the form: $$\begin{aligned} H_u(t) = -\frac{\int \big ( a(t) + \frac{db(t)/dt}{b(t)} \big ) dt}{b(t)} \end{aligned}$$ (15) where \(a(t) = p_7(t) - p_8(t)B(t) - \frac{p_7(t) \big ( H_i(t) + T_u(t) + T_i(t)\big )}{H_m}, b(t) = -p_7(t)/H_m\) . It is easy to see that as long as \(0 \le p(t)\) than \(H_u(t) \ge 0\) for any value of \(t\) . Using the fact that \(H_u(t) > 0\) , we use the same method utilized for the third equation and obtain that \(0 \le H_i(t) \) for any \(t\) . The first and second equations yield that \(0 \le E(t)\) and \(0 \le B(t)\) for any \(t\) since \(T_i(t), H_i(t), T_u(t)\) , and \(H_u(t)\) are non-negative. Thus, we show that the proposed model’s solution is non-negative for any value of \(t > 0\) if the initial condition is non-negative. Equilibria and stability analysis In order to better understand the bio-mathematical properties of the proposed model, we computed the equilibria states of the proposed model and their stability properties. Recall that an equilibrium state is reached when the system does not change without outside intervention. As such, to compute the equilibria states of the systems, we set the left side of the equations in Eqs. ( 5 – 10 ) to zero and solve for the vector \([B(t), E(t), T_i(t), T_u(t), H_u(t), H_i(t)]\) . Following this, one obtains two equilibria states: \(B(t) = \sum _{m=0}^{N-1}b\delta (t-m\tau ) / \mu _B, E(t) = T_i(t) = T_u(t) = H_u(t) = H_i(t) = 0\) and \(B(t) = E(t) = T_i(t) = T_u(t) = H_i(t) = 0, H_u(t) = H_m\) . The first one is not mathematically valid, as for different values of \(t\) , \(B(t)\) would have different values during \(0 \le t \le (N-1)\tau \) . As such, this equilibrium is well-defined for \(t > (N-1)\tau \) which results in \(B(t) = E(t) = T_i(t) = T_u(t) = H_i(t) = H_u(t) = 0\) which is the trivial equilibrium where no dynamic takes place. For the second case, it is also trivial in the sense that all cells are healthy. In order to obtain the equilibria states’ stability of the two equilibria states, we first compute the Jacobian matrix for the proposed model, following Routh–Hurwitz stability criterion 57 : $$\begin{aligned} \begin{array}{l} J = \begin{pmatrix} -p_1E-p_2T_u-\mu _B &{}\quad -p_1B &{}\quad 0 &{}\quad -p_2B &{}\quad -p_8B &{}\quad 0 \\ p_4E &{}\quad -\mu _E+p_4E-p_5T_i-p_6H_i &{}\quad \alpha -p_5E &{}\quad 0 &{}\quad 0 &{}\quad \alpha -p_6E \\ 0 &{}\quad -p_3T_i &{}\quad -p_3E &{}\quad p_2B &{}\quad 0 &{}\quad 0 \\ -p_2T_u &{}\quad -p_3T_u &{}\quad 0 &{}\quad \lambda -p_2B-p_3E &{}\quad 0 &{}\quad 0 \\ -p_8H_u &{}\quad 0 &{}\quad -1/H_m &{}\quad -1/H_m &{}\quad p_7-p_8B-2H_u/H_m &{}\quad -1/H_m \\ p_8H_u &{}\quad -p_9E &{}\quad 0 &{}\quad 0 &{}\quad p_8B &{}\quad -p_9E \\ \end{pmatrix} \end{array}. \end{aligned}$$ (16) Now, following the Hartman–Grobman theorem 58 , by setting each equilibrium state to \(J\) we obtain: $$\begin{aligned} \begin{array}{l} J_{trivial} = \begin{pmatrix} -\mu _B &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ 0 &{}\quad -\mu _E &{}\quad \alpha &{}\quad 0 &{}\quad 0 &{}\quad \alpha \\ 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ 0 &{}\quad 0 &{}\quad 0 &{}\quad \lambda &{}\quad 0 &{}\quad 0 \\ 0 &{}\quad 0 &{}\quad -1/H_m &{}\quad -1/H_m &{}\quad p_7 &{}\quad -1/H_m \\ 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ \end{pmatrix} \end{array}, \end{aligned}$$ (17) and $$\begin{aligned} \begin{array}{l} J_{healthy} = \begin{pmatrix} -\mu _B &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ 0 &{}\quad -\mu _E &{}\quad \alpha &{}\quad 0 &{}\quad 0 &{}\quad \alpha \\ 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ 0 &{}\quad 0 &{}\quad 0 &{}\quad \lambda &{}\quad 0 &{}\quad 0 \\ -p_8H_m &{}\quad 0 &{}\quad -1/H_m &{}\quad -1/H_m &{}\quad p_7+2 &{}\quad -1/H_m \\ p_8H_m &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 &{}\quad 0 \\ \end{pmatrix} \end{array}. \end{aligned}$$ (18) We compute the eigenvalues of Eqs. ( 17 – 18 ), obtaining that both have at least one eigenvalue that equals zero due to the third line being full of zeros, respectively. Hence, both equilibria are unstable. Thus, one can learn that the proposed model is chaotic as the model has only unstable equilibria points which makes it shift all the time. Even when an equilibrium is reached, the introduction of a small cancer population would cause a significant shift in the biological system’s state. Empirical analysis Data acquisition and preprocessing We obtained retrospective data from the Bnai-Zion Medical Center (Israel) from 2008 and 2017 59 . The data was anonymously extracted from the hospital’s records under the following restrictions: (1) patients are adults ( \(>18\) years old); (2) Patients received the standard BCG-based treatment for their non-invasive bladder cancer; (3) Patients were admitted between 2008 and 2017, in which period where all patients obtained the same treatment protocol for a non-invasive BC. In total, 417 BC patients are included, representing the entire patient population satisfying these three conditions. For each patient, we extracted the size of the cancer tumor at the beginning and end of the treatment alongside the four socio-demographic properties outlined above (gender, age, smocking, and weight). Additionally, for each patient, we extract the amount of BCG injected \((b)\) , the number of BCG injections \((N)\) , the duration between every two consecutive BCG injections \((\tau )\) , BCG’s decaying rate \((\mu _B)\) , and the number of cells in the bladder \((H_m)\) . The BCG-treatment-related parameters ( \(b, N, \tau \) ) are defined by the standard treatment protocol 7 to be \(2.8 \times 10^8, 6,\) and \(7\) days. The amount of cells in the bladder is highly linear to the patient’s age and weight 60 , 61 . To define the different weight categories defining each socio-demographic group, we adopted the definition processed by the Centers for Disease Control and Prevention (CDC). As such, we use the formula proposed in 62 to approximate this value. The above is summarized in Table 1 . In addition, as \(T_i(0) + T_u(0)\) and \(T_i(t_f) + T_u(t_f)\) that required by the fitting procedure are not measurable “as is” rather than the polyp’s volume it measured, one is required to map between these two values. To this end, we used the average volume of bladder cancer cells 63 and the polyp’s volume to approximate \(T_i(0) + T_u(0)\) and \(T_i(t_f) + T_u(t_f)\) . Table 1 The model’s parameter definitions and average values as adopted from 26 , 27 . Full size table Parameter fitting In order to use the proposed parameter fitting procedure, one is required to define a fitting metric. Hence, to make sure the model is able to better predict the outcome of a treatment procedure given an initial condition, we used the relative absolute error metric between the model’s prediction and the historical data. Formally, let us denote the cancer population the model’s prediction, and historical using \(T_{t_f}^m\) and \(T_{t_f}^h\) respectively. The relative mean absolute error than takes the form \(RMAE := \frac{1}{|P|}\sum _{p \in P} |T_{t_f}^m - T_{t_f}^h|/(T_{t_f}^h)\) such that \(P\) is the population of patients. Now, following the proposed fitting procedure (see section “ Treatment model fitting ”) and the acquired data, we fitted the model and obtained \(28.51 \pm 3.76\) relative absolute error on the test set of \(k=5\) folds. Figure 4 shows the distribution of the relative mean absolute error among the four socio-demographic features - smoking habits, weight group, age group, and gender. We use black boxes to indicate configurations that could not be assessed given the available data (i.e., no single test case was available). The number of individuals in each socio-demographic group is provided in the supplementary materials . Notably, non-smokers with underweight have the worst fitting results compared to other configurations. This may be partially attributed to the small number of samples within these groups during the training phase - 13 in total. In addition, we compared the performance of the model’s fitting, divided into smokers and non-smokers groups, using a two-tailed t -test 64 . We obtained that zero is not included in the confidence interval of the t -test, which indicates that the two groups are not statistically significantly different. In a similar manner, when comparing the model’s fitting performance between male to female patients using a t -test, we obtain \(p = 0.061\) which indicates no statistically significant difference. Moreover, when comparing the weight categories using an ANOVA test with post-hoc Tukey pairwise tests 65 , we see that the normal weighted category obtains statistically worse results compared to the two other categories \(p < 0.05\) . Similarly, the 56–65 and 65+ age groups obtained statistically significantly worse results compared to the younger age groups with \(p < 0.05\) . Figure 4 The average over \(k=5\) folds relative absolute error of the model’s fitting on the test set. The black boxes indicate that no patients belong to this combination of socio-demographic values. Full size image Evaluation We evaluate the proposed model by comparing it to two baselines: First, we use a narrow version of the proposed model which does not use of the socio-demographics at all. Second, we use the original model proposed by Bunimovich-Mendrazitsky et al. 25 as provided by the authors. Figure 5 shows the relative mean absolute error of the three models for 50 samples. We choose the samples such that each sample would have a unique combination of the socio-demographic values. One can clearly see that the proposed model outperforms both other baselines with an average relative absolute error of \(19.38 \pm 5.27\) compared to \(26.04 \pm 6.85\) and \(34.18 \pm 7.02\) , respectively. To statistically support this result, we conducted an ANOVA test with a one-tailed t -test post-hoc correction between the three groups 65 . The analysis reveals that with \(p < 0.05\) the proposed model outperforms both other models. Figure 5 A comparison between the proposed model, the proposed model without socio-demographics, and the standard model 25 . Full size image Discussion In this study, we presented a mathematical model to describe the dynamics of BCG-based immunotherapy for BC which incorporates socio-demographic parameters, such as age, gender, smoking behavior, and weight, to capture the heterogeneity in the patient populations and provide a more accurate treatment outcome prediction. By categorizing patients into distinct, easily identifiable, socio-demographic groups, we acknowledge the diverse characteristics of BC patients and their potential influence on the treatment outcome 66 , 67 , 68 . This approach allows one to tailor more personalized models and thus obtain a better understanding of how different patient profiles may respond to BCG-based immunotherapy. To this end, we used a novel fitting procedure that uses machine learning methods with only partial and sparse historical data to fit the personalized model for each socio-demographic group. Our results strongly suggest that the currently unexploited socio-demographics may encompass clinically relevant information which underlines the BCG-based immunotherapy treatment of non-invasive BC. Most notably, the proposed model which takes these socio-demographics into account outperforms the baseline model proposed in 25 by \(14.8\%\) as well as the same model which does not consider socio-demographics by \(8.14\%\) , as shown in Fig. 5 . Arguably, these improvements should be attributed to the more personalized, thus accurate, ODE model. We observe further support for this observation in Fig. 4 which shows that different socio-demographic groups are associated with different fitting performances. This outcome can be associated with two factors: First, the differences in the amount of available data used to fit the model. Second, the clinical processes and dynamics that change as a result of belonging to each socio-demographic group. The effect of the first factor is clearly revealed for the non-smoker and the underweight group as a low amount of fitting data results in the highest, on average, fitting error. In a complementary manner, the second factor can be seen in older patients having higher fitting errors, on average, compared to younger patients while being a large portion of the dataset. It is important to note that our model and results have certain limitations. First, the proposed model does not take into consideration the geometrical configuration of the bladder and therefore the spatial dynamics of the BCG treatment which has shown to have a critical role in the treatment outcomes and optimal treatment protocol for patients 35 , 69 . As such, one can introduce these extensions to obtain a more realistic model. Second, the model assumes that a patient’s socio-demographic properties remain constant during the course of BCG treatment. While this assumption is accepted due to the short duration of the treatment (i.e., around two months), it may not fully capture potential changes in patient characteristics that could influence treatment response. Third, the proposed model is partially personalized. Potentially, by using more parameters, one can obtain better personalization and even further improve the model’s prediction accuracy 70 . Finally, our model focuses on the treatment protocol clinical outcome prediction rather than suggesting an optimal personalized treatment as other studies do 26 . In future work, we plan to further investigate this direction. Overall, the proposed model provides a low (to no) overhead method for clinicians while providing a statistically significant improvement in the prediction of treatment outcomes. Thus, it can be easily adopted by healthcare professionals and help provide better treatment, saving and improving many lives. In the same manner, our proposed fitting method can be utilized in a broad spectrum of models as it assumes as little as possible on the historical data and nothing on the model itself.