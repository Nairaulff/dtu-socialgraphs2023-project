introduction boron neutron capture therapy bnct utilizes property boron-containing drug high capture cross section thermal neutron kill tumor cell using two heavy ion created nuclear reaction range two heavy ion approximately size cell heavy ion kill nearby cell damage cell boron-containing drug selectively accumulate tumor cell cooperated suitable neutron source effect local killing tumor cell minimizing damage normal cell achieved due unique advantage bnct field radiation therapy many bnct treatment center constructed treat cancer patient core subsystem precision radiotherapy treatment planning system tps applied calculate expected dose distribution determine appropriate irradiation parameter optimal treatment result conventional radiotherapy represented photon beam tps apply simplified numerical model-based approach speed calculation however approach feasible bnct bnct beam contains mixture neutron photon secondary particle neutron may neutron photon make difficult simplify dose calculation addition different particle may need different radiobiology weighting factor make even complicated described simplified way therefore monte carlo calculation usually applied radiation simulation bnct although research clinical application bnct comparatively short several research institution researcher developed tps applicable bnct tpss bnct treatment use general-purpose code mcnp e.g. nctplan thorplan phits e.g. jcds tsukuba plan neucure dose calculation engine although development strategy reduce difficulty tps development best choice reason follows general-purpose code developed bnct lack quality control testing requirement medical software make difficult ensure reliability safety medical software meet regulatory requirement general-purpose code powerful applicable wide range application therefore requires many cross-section library subroutine turn mean difficult optimized specific purpose much longer time required complete calculation task make difficult handle large number patient treatment plan need revised within short period e.g. original irradiation location found unattainable day irradiation computational statistical accuracy general-purpose code satisfy need computation time proportional square statistical accuracy function general-purpose code fully tailored bnct application scenario making difficult accurately describe bnct calculation model especially beam source definition tpss bnct engine serum simulation environment radiotherapy application result study show dose calculation result serum deviate significantly dose calculation result general-purpose code especially skin therefore used treatment planning system precision radiotherapy bnct dose calculation code employing gpu-accelerated monte carlo method significantly reduces computation time study lee employ multi-group monte carlo method calculate neutron flux precision approach fall short compared continuous-energy monte carlo method thus general-purpose monte carlo code prefer use continuous-energy monte carlo method due superior accuracy consequently lee emphasize case head voxel model mean absolute percentage error neutron flux absorbed dose 3.98 3.91 respectively considered unacceptable radiotherapy deviation render improvement computation speed insignificant reason independently developed dedicated engine compass compact particle simulation system neumanta tps specifically bnct bnct dose calculation achieved goal significantly reducing computation time without sacrificing accuracy dose calculation addition program customizes geometric model source distribution definition bnct specifically make calculation model closer real application scenario bnct thus dose distribution patient calculated efficiently accurately method introduction neumanta neumanta designed specific feature tailored bnct treatment planning including user-friendly visual interface medical image processing module voxel model building module database relative biological effectiveness rbe compound biological effectiveness cbe dose calculation engine report generation module neumanta support dicom format widely adopted medical field including support dicom-rt creating treatment plan neumanta first read patient image data automatically generates multiple human tissue material based hounsfield unit value image data within neumanta user select location direction radiation source type collimator used setting treatment parameter input file compass dose calculation generated submitted compass calculation upon completion physical dose output file generated neumanta read use calculate equivalent biological dose voxel based cbe rbe various material user determines treatment plan whether accept irradiation condition based biological dose distribution workflow compass considering lengthy computation time general-purpose code challenge accurately describing bnct calculation model using numerical method developed calculation code compass figure illustrates timing chart various module compass involved formulation radiotherapy plan figure workflow compass full size image first neumanta generates input file required compass calculation based parameter provided user compass read input file begin initialization process includes creating geometry creating material reading neutron cross-section database nuclide reading photon cross-section database element source created based input file information memory allocated tally vector according grid size vector initialized zero next mc_run module compass simulates particle history involves sampling particle state locating particle position calculating cross-sections particle interaction material calculating distance nearest surface processing particle collision material accumulating dos deposited voxels process repeated particle simulated finally tally data normalized total number particle physical dose output file generated neumanta dose calculation compass compass system interaction neutron photon matter meticulously treated mirror procedure incorporated general-purpose monte carlo code thereby bolstering validity dose calculation result photon involves simulation phenomenon photoelectric effect compton scattering pair production similarly neutron handling includes process like elastic scattering inelastic scattering capture reaction thermal scattering among others comprehensive approach encompassing wide array interaction ensures compass treatment aligns methodology used general-purpose code thereby validating accuracy calculated dose outcome charged particle deposited locally compass since dose bnct mainly contributed heavy ion rather electron dose estimation compass calculated track length estimation calculated d\left flux particle voxel determined motion history particle corresponds ith nuclide material voxel density ith nuclide total reaction cross-section ith nuclide particle energy average energy deposition collision particle energy ith nuclide reaction cross section average energy deposition calculated nuclear data library based energy interpolation particle type photon photon dose accumulated neutron dose accumulated way material boron contained neutron dose contributed atom added boron dose reduce dose calculation time several optimization method used compass general-purposed algorithm explained next section mainly based mcnp reference mcnp general-purpose n-particle code version mcnp6 developed los alamo national laboratory one commonly used general-purpose code since several tpss bnct use mcnp dose calculation engine dose calculation output file mcnp6 also read neumanta mainly use mcnp6 comparison software compass energy interval search algorithm cross-section calculation one time-consuming step simulating particle history cross-section data several energy node provided database energy particle often middle two adjacent energy node therefore key step cross-section calculation find energy interval database corresponding current particle energy given energy node cross-section data uniformly distributed binary search frequently employed energy interval search depicted fig fundamental principle binary search ascertain whether particle energy resides upper lower half energy node iteration search range narrowed based determination process repeated final node position identified relationship binary search time total number energy node logarithmic energy node longer binary search time number energy node cross-section database usually high thousand even ten thousand therefore calculation time neutron cross-section processing costly figure workflow binary search hash search algorithm full size image reduce time cross-section calculation hash search used replace binary search compass workflow hash search algorithm shown fig contrast hash search algorithm necessitates additional preparatory step compared binary search illustrated fig process commences establishment uniformly distributed energy node using logarithmic interpolation maximum emax minimum emin value new energy node depend range old energy node cross-section database scope new energy node must encompass old energy node subsequently position old energy node new energy node calculated portion work completed initialization step reading cross-section data library thereby impacting computational speed particle simulation given particle energy new interval grid calculated first using u\_grid min m/\left max min represents total number new energy node sufficiently large number old energy node given new energy interval becomes limited e.g. one allowing old energy node location quickly identified result hash search time longer correlated number old energy node notably faster binary search primary drawback hash search method increased memory usage storing new energy node however boron neutron capture therapy bnct dose calculation memory required cross-sectional database relatively small rendering disadvantage acceptable contrast nuclear reactor calculation energy node fission nuclides extensive numbering hundred thousand causing cross-section database occupy significant amount memory transportation optimization method main geometric model bnct dose calculation lattice bnct lattice uniformly structured grid grid filled one material make model closer real situation grid finely divided caused high probability adjacent voxel filled material workflow simulating one particle general-purpose code e.g. mcnp shown fig figure workflow simulating particle history general-purpose code compass full size image step particle transported one voxel adjacent voxel macro cross-section calculated new voxel step voxel material particle energy change since particle energy could changed collision event macro cross-section new voxel necessary calculate macro cross-section twice compass particle transported voxels energy changed material step skipped step shown fig reduce time calculating cross-section dose tally optimization method monte carlo code mean value statistical error calculated long algorithm utilized mean value corresponds dose required statistical error serf indicator determining whether convergence achieved consequently crucial accurately calculate mean value statistical error doe need precise mean value calculated mean statistical error calculated error mean^ dose tally particle total number particle enough calculate mean error accumulating particle pas grid leave track dose contribution track calculated particle pass voxel twice dose contribution total dose contribution total error contributes however determining whether particle ever passed given grid time-consuming step many voxels compass skip step accumulate tally error particle enters two different voxels total dose contributes total error contribute mean value since error underestimated error quite deviation real value calculation time significantly reduced worth using time-saving method listed performed calculation neutron dos various tissue model confirm efficiency implemented algorithm table display dose calculation result statistical error tissue using dose tally optimization algorithm optimization algorithm demonstrates impact dose result statistical error calculated optimization lower true statistical error table neutron dose average voxel error optimization full size table introduction compass function cross-section library applied compass hierarchical data format version hdf5 format version endf/b-viii.0 firstly used openmc code general-purpose code e.g. mcnp phits ace compact endf format hdf5 specifically applied large-scale data input output much efficient ace format compass also faster loading cross-section data function required bnct dose calculation available compass source sampling physical geometry construction dose tally reduce calculation time mpi library openmp instruction used increased computing speed user reduce computing time minute long number computer core sufficient accurate definition radiation source essential ensure correctness dose calculation result compass flexible source definition function allows definition various type radiation source since neutron photon included radiation source bnct compass allows user define different type particle source different type distribution addition compass add spatial rotationally symmetrical distribution type radioactive source type best match real bnct radioactive source distribution lattice constructive solid geometry csg definition allowed compass however since grid model used bnct dose calculation relatively simple voxel containing one material compass directly defines voxel mesh form structural mesh simplifying logic geometric definition processing compass doe implement multi-layer geometric definition function limit ability make direct comparison nevertheless optimization contributes overall computing efficiency result algorithm acceleration effect optimization algorithm described test acceleration effect different algorithm describe implemented algorithm general-purpose code new optimized algorithm compass compared difference computational speed table give acceleration effect three optimization algorithm acceleration effect total calculation time calculated accelerate\ effect 100\ table acceleration effect three algorithm full size table table first second optimization algorithm reduce computation time macro cross section third optimization algorithm reduces time dose tally first two optimization algorithm side effect third optimization algorithm underestimate statistical error dose test result show third optimization algorithm lead approximately underestimation statistical error data given table statistical error using third optimization algorithm since statistical error used assessment whether calculation result converge cost worthwhile since significant improved calculation speed true statistical error changed accuracy verification dose compass mcnp6 several actual head neck cancer case compared using compass mcnp6 one presented section head neck cancer model shown fig figure show computer tomography image roi information retrieved rtstruct file tag brain represents normal brain tag gtv_pet represents tumor region defined based pet image f-bpa pet/ct fusion image full size image model blood boron concentration ppm tumor boron concentration ppm voxel size measure 0.75 0.75 number grid material voxel automatically transformed value neumanta geometry material composition consistent compass mcnp6 treatment source irradiation direction right left proportion thermal neutron epithermal neutron ev-0.1 mev fast neutron 0.1 mev respectively total number neutron simulated compass mcnp6 boron dose neutron dose photon dose calculated voxel distribution neutron dose given slice calculated compass mcnp given fig figure dose distribution calculated compass mcnp6 full size image result neutron dose distribution calculated compass mcnp seen visually fig nearly impossible tell difference eye nonetheless calculation result two code must compared quantitatively mean maximum dos important consideration treatment plan-making table show relative deviation mean maximum dos tumor well normal tissue calculated compass mcnp see calculation method relative deviation tumor roi minimum dose interest cold spot may lead recurrence future tumor minimum dose component result listed table relative statistical error dose given parenthesis following dose data table relative\ deviation mcnp compass mcnp 100\ table mean maximum boron dos tissue calculated using compass mcnp full size table table mean maximum neutron dos tissue calculated using compass mcnp full size table table mean maximum photon dos tissue calculated using compass mcnp full size table table minimum tumor dose calculated using compass mcnp full size table table maximum relative deviation max boron neutron dos calculated compass mcnp 2.14 2.41 found brain stem deviation may decreased statistical error could decreased relative deviation mean boron neutron dos smaller 0.5 relative deviation photon dose result larger statistical error larger maximum relative deviation mean photon dose 1.1 tumor maximum relative deviation maximum photon dose 3.03 spinal cord difference tolerable treatment plan-making note although difference photon dose larger contribution total dose small addition larger deviation may improved decreasing statistical error according calculated result conclude significant difference calculation done compass mcnp result generated code equally accurate another data point interest user dvh dose-volume histogram user clearly see percentage tissue volume within safe dose range dvh per dose calculation compass mcnp given fig figure dvh diagram mcnp6 compass full size image result fig show dvh compass mcnp almost exactly overlap three dose component proving consistency calculated result program order succinctly illustrate precision compass within diverse head neck cancer brain cancer model parameter gamma pas rate employed metric delineates level congruity dosimetric outcome computed compass mcnp6 originally implemented gamma radiotherapy method lends well extension bnct gamma pas rate determined ratio voxels gamma function gamma function individual voxel calculated using r\left represents spatial distance evaluated dose point reference dose point denotes variance evaluated dose position reference dose position serf distance-to-agreement criterion act dose difference criterion comparative analysis dose difference criterion established maximal dose table seen average dose normal tissue much greater maximum dose tumor distance-to-agreement criterion designated voxels dos exceeding maximum dose included comparison region low dos clinically insignificant term treatment impact diminution dose difference criterion distance-to-agreement criterion corresponds elevation gamma pas rate maximum value indicating enhanced consistency two dose distribution comparative study gamma pas rate dose distribution computed compass mcnp6 five head neck brain cancer model recorded 99.78 98.79 98.31 99.32 99.51 respectively value near affirm consistency dose calculation outcome compass mcnp6 across various model computational speed comparison compass mcnp verifying accuracy dose calculation result compass computing efficiency compass tested computing efficiency code characterized fom figure merit fom defined following equation fom relative standard deviation computation time given code computation time usually inversely proportional square relative standard deviation i.e. decrease relative standard deviation half computation time must increased four time therefore larger fom indicates higher computing efficiency avoid effect parallel efficiency computing efficiency computing efficiency compared based single central processing unit cpu core model single core computation time 22,243 compass 57,491 mcnp6 table show mean statistical error three type dos tumor calculated two program comparison fom result statistic error compass calculated without dose tally optimization method statistic error underestimated table comparison fom compass mcnp full size table result table show fom compass larger mcnp6 approximately 2–3 time larger fom mcnp6 implying computing efficiency compass 2–3 time faster computing efficiency mcnp6 table demonstrates significantly greater acceleration effect compared table 2–3 time compared table compare calculation speed compass using different algorithm whereas table compare compass mcnp result since compass mcnp independent software different code implementation may also impact performance mcnp complex functionality also result intricate computational logic potentially causing loss performance performance improvement shown table reach 2–3 time addition compass support parallel computing calculation time single core 20,000 long multi-core computer significantly reduce computation time compass test result parallel computing compass show 14-core intel® core™ i9-7940x x-series processor computation speed compass increased 13.96 time single core computation time reduced min calculation time mcnp6 one hour calculation condition compass dose computation speed line treatment need discussion conclusion owing slow dose computation speed general-purpose code mcnp6 challenge associated meeting medical software requirement developed monte carlo dose engine compass compass demonstrates comparable dose computation accuracy mcnp6 computation time 30–50 mcnp6 computation time however since compass specifically designed bnct feature two function dose calculation reaction rate calculation additionally fission bnct treatment scenario compass doe include code fission physical process moreover due simplified geometric definition defining complex geometry compass challenging mcnp besides optimization algorithm mentioned variance reduction technique employed bnct dose calculation weight window spatial importance also contemplating introduction gpu acceleration bnct dose calculation ensuring accuracy calculation remains uncompromised summary compass significant advantage mcnp6 dose calculation test result reveal compass computation time reduced reasonable range high-performance cpu currently calculation real head-and-neck tumor case completed within min using four 14-core intel® core™ i9-7940x x-series processor running parallel confident compass could complete case within min near future due improvement calculation efficiency advancement cpu computation power compass enables use complex voxel model dose modeling bnct