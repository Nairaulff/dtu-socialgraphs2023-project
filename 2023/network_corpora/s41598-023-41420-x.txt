introduction apart significantly effective revealing pathological alteration chest x-ray cxrs posse noninvasive characteristic exhibit minimal radiation exposure economical result chest radiography one frequently performed medical imaging test early diagnosis numerous lung heart disease according recent survey radiography cxrs account 3.6 billion imaging procedure performed worldwide every year number expected continue increase people access medical care moreover volume x-ray data increase resultant burden radiologist increase along compelled read study within shorter period often lead diagnostic error thus computer system identifies abnormal cxrs could provide benefit ensuring efficient use radiologist time also maintaining quality safety radiological care recent advance deep learning technology enabled significant performance improvement image-anomaly detection particular supervised anomaly detection demonstrated significantly improved performance learning training dataset containing normal abnormal sample however implementing supervised approach detecting anomaly cxrs would ineffective collecting large-scale labeled anomaly data fully characterize notion anomalousness often impractical real clinical setting instead since normal cxr image account overwhelming proportion data anomaly detection cxrs formulated unsupervised one-class classification problem essentially case anomaly detection learns normality normal cxr data abnormal cxrs become detectable due deviation learned model previous study reported subtle radiological finding small pneumothorax likely visible higher resolution however several case deep learning model trained reduced low-resolution cxr image owing limitation hardware capability difficulty training large-scale network significantly increased training time address problem input cxr image split fixed-size patch anomaly score patch computed however shortcoming patch-based approach may fail grasp association diverse unknown scale within image therefore study proposed unsupervised anomaly detection method cxrs using multiresolution patch-based self-supervised learning primarily approach involves computing weighing anomaly score based different patch size aggregating generate final anomaly map accommodates irregular variable size anomaly cxr image furthermore unlike natural image anomaly medical domain tend strongly resemble normal data created demand enhancing discriminative power deep feature learned normal cxr data therefore proposed method employ contrastive learning popular form self-supervised learning—to learn generalized robust feature patch related work anomaly detection long-studied problem significant number method technique proposed classical approach principal component analysis pca support vector data description svdd kernel density estimation recent deep learning-based approach however since study specifically deal unsupervised anomaly detection cxr image review related research focus primarily method involving unsupervised deep learning-based anomaly detection image notably comprehensive survey anomaly detection method found literature one method reconstruction-based method take representative approach unsupervised image-anomaly detection hypothesis adopted reconstruction-based method model trained normal data accurately reconstruct abnormal image however doe always hold true network trained single class successfully represent out-of-class example given in-class object sufficiently diverse learning probability distribution normal data another representative approach anomaly detection objective approach model distribution normal data directly predict whether new sample distribution svdd classic one-class classification technique category—it essentially fit smallest possible sphere around given data point allowing point excluded outlier furthermore deep svdd improved predecessor implementing deep neural network minimize volume hypersphere enclosing feature representation data moreover vector-quantized variational autoencoder autoregressive model used estimate distribution latent representation data however method based approach often require careful calibration learning discriminative data representation self-supervised learning ssl aim learn relevant feature representation using pretext task recently numerous unsupervised anomaly detection method leveraged ssl learn discriminative feature normal data act reliable landmark instance tan proposed poisson image interpolation pii train model detect subtle irregularity introduced via poisson image editing ssl pii method produce new training sample naturally replacing pixel random patch convex combination two normal training sample furthermore patch svdd extends deep svdd application patch-based method using self-supervised learning input image divided fixed-size patch encoded inspected independently fine-grained examination performed addition used predict relative position two randomly selected patch ssl allows feature form multimodal cluster thereby enhancing anomaly detection capability furthermore kim proposed unsupervised anomaly detection localization algorithm using progressive autoencoder combined patch-level contrastive learning instead applying different transformation patch image patch image location original image restored image autoencoder defined positive study unlike conventional contrastive learning approach yoa leveraged positive pair normal image learn global dense representation addition extended learned model using pseudo-abnormal image generated dynamic local augmentation meanwhile zhang proposed deep adversarial anomaly detection method utilized ssl along adversarial training method anomaly detection ssl approach auxiliary classifier leveraged learn task-specific latent feature classifying original pseudo data hence learned feature discriminative generic method proposed study similar patch svdd since utilize patch-based ssl process highly complex image however proposed methodology prominent difference patch svdd first rigid partitioning image patch fixed size may fail consider anomaly different shape size therefore given cxr image approach produce separate anomaly map according patch resolution aggregate generate final anomaly map second study proposes simple yet efficient algorithm considers patch locality compute anomaly score material method since current research retrospective study patient informed consent ethical review study waived institutional board kyonggi university data obtained existing de-identified public datasets addition method performed accordance relevant guideline regulation dataset padchest representative large-scale high-resolution cxr image dataset multilabel annotated report includes 160,000 image 67,000 patient labeled different radiographic finding different diagnosis anatomic location particular report manually annotated radiologist remaining data annotated automatically using recurrent neural network attention mechanism dataset extracted 7,375 manually annotated posteroanterior cxr image response need reduce negative effect incorrectly labeled data consisted normal abnormal cxr image resolution cxr image ranged approximately pixel 12-bit grayscale color depth since proposed method required normal cxr image model training image randomly split three subset without overlap training validation testing validation testing abnormal cxr image randomly selected sample without overlap table present detail dataset breakdown table dataset detail full size table proposed method figure depicts entire process detecting abnormal cxr image using proposed method solid dotted line represent training classification process respectively training phase cxr image first split group patch image predefined set patch size using image patch generator resulting patch image size used train corresponding deep feature extraction model using self-supervised contrastive learning completion training phase feature representation every normal patch image computed stored reference database n-tuple containing patch size coordinate patch original cxr image learned feature figure overall process anomaly detection cxr image full size image given query cxr image patch image different size generated way training process feature extracted corresponding deep feature extraction model following anomaly map generator used generate final anomaly map using extracted feature reference database representing feature space anomaly score patch image defined inverse similarity score nearest normal patch feature space anomaly map individual patch size generated using computed anomaly score every patch image subsequently final anomaly map generated aggregating multiple anomaly map based different patch size different weight following section present detailed explanation deep feature extraction model anomaly map generator patch size separate self-supervised deep feature extraction model learns represent discriminative feature normal patch image size using contrastive learning recently contrastive learning shown promising result numerous computer vision task particular simclr state-of-the-art self-supervised contrastive learning approach based contrastive instance discrimination see fig aim learn representation maximizing agreement differently augmented view data example using contrastive loss latent space figure simclr framework two independent data augmentation operator sampled predefined family augmentation pair sample referred positive generated image neural network encoder projection head trained maximize agreement feature representation two sample completion training projection head discarded full size image contrastive loss used simclr defined normalized temperature-scaled categorical cross-entropy loss cosine similarity representation equation present loss function positive pair sample k=1 k\ne indicator function return iff denotes dot product scalar temperature parameter =-\mathrm log exp k=1 k\ne exp role anomaly map generator produce anomaly map based patch size aggregate different weight produce final anomaly map generate anomaly map given patch size anomaly map generator first determines feature representation reference database similar query patch image size —the higher similarity score normal patch image therefore anomaly score computed inverse similarity score subsequently patch-wise anomaly score assigned pixel contained patch owing diversity organ size shape radiographic positioning individual patient cxrs patch position two different cxr image may contain dissimilar content therefore simply using location information reference normal patch feature comparison may inappropriate however investigating patch search space lead significant increase computational cost addition feature representation unrelated patch may likely returned search result therefore minimize chance using feature representation region unrelated location query patch image extracted used simple yet efficient algorithm account patch locality figure present pseudocode computing patch-wise anomaly score context patch distance configurable parameter control choice adjacent patch area measuring similarity score see fig figure algorithm computing anomaly score given query patch image full size image figure algorithm computing anomaly score given query patch image along illustration effect path distance parameter yellow cell indicates location query patch image blue cell refer location adjacent reference normal patch image considered measuring similarity score query patch image reference patch image location query patch image full size image given query patch image degree similarity depends extent follows data distribution used train deep feature extraction model measured similarity function sim study used several distance function e.g. euclidean distance manhattan distance cosine similarity mahalanobis distance similarity function examine performance two given feature representation corresponding equation individual distance function shown denotes sample covariance matrix euclidean =\sqrt i=1 manhattan =\sum_ i=1 cosine\_sim =\frac p\cdot p\vert q\vert =\frac i=1 i=1 i=1 mahalanobis =\sqrt x-y\right x-y anomaly map generated according patch size e.g. final anomaly map e.g. final produced aggregating anomaly map using element-wise multiplication weight normalizing resulting intermediate anomaly map shown weight assigned anomaly map patch image size final normalize a\left a\left following determining whether given query cxr image abnormal quite simple anomaly score query cxr image represented highest anomaly score pixel final —the cxr image considered abnormal anomaly score larger predefined threshold pixel higher anomaly score value approximated abnormal region experimental result discussion evaluation metric training detail performance proposed method evaluated term accuracy precision recall specificity corresponding equation evaluation metric noted indicate true positive false positive true negative false negative prediction respectively addition area receiver operating characteristic auroc curve measured evaluate accuracy classification performance accuracy=\frac +\mathrm +\mathrm +\mathrm +\mathrm precision=\frac +\mathrm sensitivity=\frac +\mathrm specificity=\frac +\mathrm final evaluation applied five-fold cross-validation dataset fold measured corresponding performance metric final result averaged result furthermore contrastive learning model used simclr trained resnet-50 base encoder network two-layer mlp projection head using four nvidia geforce rtx 2080ti graphic card ubuntu 18.04.5 lts environment encoder network produced h=f feature projection head produced z=g feature mini-batch size number training epoch set respectively data augmentation used random cropping rotation process grayscale cxr image entire network trained end-to-end manner using lars optimizer learning rate 4.8 weight decay simclr prior training evaluation cxr image resized pixel without normalization addition since patch resolution pixel considered minimum size containing distinguishable feature cxr image predefined set patch resolution set throughout experiment patch distance parameter patch image set respectively patch resolution e.g. pixel patch distance parameter set threshold determining abnormality set 0.5 note objective study determine optimal parameter setting search optimal hyperparameters value left future study result discussion first conducted experiment ass effectiveness multiresolution patch-based anomaly detection method single-resolution patch-based method purpose proposed method modified use patch image fixed size training testing phase component including simclr applied without change single-resolution patch-based method evaluated performance according similarity function used table list quantitative result value bold denote best performance result indicate patch resolution providing best performance varied depending evaluation criterion instance combination patch resolution euclidean distance function similarity function outperformed setting term sensitivity e.g. 0.71 whereas combination patch resolution mahalanobis distance exhibited best performance 0.74 auroc general method using higher patch resolution similarity function tended provide better overall performance phenomenon explained fig present patch image different resolution given cxr image herein patch size may regarded receptive field therefore although small patch size known helpful capturing local context lack ability gather global semantic information critical determining structural deformity instance approximating left cardiac shape becomes difficult patch size decrease table comparison performance single-resolution patch-based anomaly detection full size table figure effect patch resolution identifying radiographic finding input cxr image size divided patch image different size example resulting patch image size w/2 h/2 w/4 h/4 w/8 h/8 arrow identify location patch image within original input cxr image full size image similarly evaluated multiresolution patch-based anomaly detection method changing weight patch size used generate anomaly map similarity function table present subset result exhibited relatively good performance term represent weight patch image size respectively similar result presented table feature extracted patch image size relatively low impact determining abnormality cxr image thus configuration exhibiting good performance considerably low value corresponding weight e.g. result clearly demonstrate fusing feature patch image different size play crucial role constructing discriminative feature anomaly detection particular multiresolution patch-based anomaly detection method mahalanobis distance set 0.1 1.2 1.2 1.0 respectively exhibited comparable better performance best performance obtained single-resolution patch-based method regardless evaluation criterion meanwhile although single-resolution patch-based method exhibited different performance depending evaluation criterion multiresolution patch-based method selected configuration e.g. mahalanobis distance weight 0.1 1.2 1.2 1.0 consistently exhibited good overall performance regardless evaluation criterion used comparison table comparison performance multi-resolution patch-based anomaly detection method full size table additionally compared proposed method recent state-of-the-art unsupervised anomaly detection method f-anogan patch svdd pix2pixhd salehi squid f-anogan representative reconstruction-based anomaly detection method two adversarial network generator discriminator encoder separately trained using normal image map input image corresponding location learned latent representation experiment modified size input patch image official f-anogan implementation process cxr image particular first version f-anogan resized input cxr image pixel extracted image patch pixel randomly sampled position input image second version f-anogan used input image size used pixel patch image size similarly modified official implementation patch svdd use input size pixel patch size pixel denoted patch svdd another version denoted patch svdd used input image patch size pixel respectively note selection image patch size account constraint computational resource used experiment comparison included deep autoencoder-based anomaly detection method frequently adopted baseline performance indicator particular replaced symmetric encoder-decoder architecture deep autoencoder pix2pixhd process high-resolution cxr image pix2pixhd-based anomaly detection system input cxr image resized pixel latent vector size used feature representation salehi squid used official implementation hyperparameter setting reported delivered best performance original publication addition cxr image resized pixel input salehi squid respectively consistent value used publication meanwhile multiresolution patch-based method used mahalanobis distance similarity function set 0.1 1.2 1.2 1.0 respectively exhibited best performance table table list performance method investigated comparison conducted study f-anogan method using different patch size affect overall performance either method contrast patch svdd used input image patch size four time larger patch svdd thus outperforming patch svdd large margin 8.9 aspect result certainly attributed image size high-resolution image enabled patch svdd learn extract fine feature representation enable subtle radiological finding addition encoder benefit larger patch size since enlarged receptive field enables feature representation explicitly learn long-range dependency furthermore performance pix2pixhd-based anomaly detection method slightly better patch svdd conjecture pix2pixhd-based anomaly detection method suffered limited receptive field could capture long-range dependency pix2pixhd-based anomaly detection method learned latent feature normal data without patch interestingly despite using smaller cxr image salehi squid achieved competitive better performance pix2pixhd-based method result may attributed use sophisticated algorithm technique modeling distribution normal feature image in-painting-based data augmentation multiresolution knowledge distillation among method proposed method observed deliver better performance regard evaluation criterion except sensitivity instance proposed method achieved accuracy precision specificity auroc 0.73 0.83 0.89 0.75 improvement 8.96 27.69 43.55 4.17 respectively compared salehi showed best performance comparison group table comparison performance proposed method state-of-the-art method anomaly detection cxr image full size table figure illustrates test example cxr image corresponding anomaly map correctly classified normal test cxr image proposed method found nearest normal patch image learned feature space confirmed corresponding query cxr image contained anomaly abnormal test cxr image top one cxr patient alveolar pattern bottom one cxr patient cardiomegaly example confirm deep feature normal patch learned separable abnormal one using proposed method although method able determine cxr image normal anomalous exhibiting competitive performance still room improvement anomaly localization shown fig anomaly localization requires accurate computation pixel-level anomaly score model however patch-wise calculated anomaly score assigned pixel within patch made difficult disassociate anomalous pixel normal one addition unsupervised learning without ever seeing anomalous sample class training make task even challenging figure radiograph selected correctly classified examples—the anomaly score generated proposed method showed best performance experiment truth label normal predicted label normal truth label abnormal predicted label abnormal full size image figure depicts radiograph selected misclassified example according anomaly score top cxr image fig extracted latent feature query cxr image resided boundary area feature space normal abnormal making accurate prediction difficult bottom cxr image fig example proposed method misclassified presence anomaly lung mass limitation addressed adding normal cxr image training encoder feature representation however despite strong visual similarity two cxr image may classified differently due subtle difference inherent challenge medical anomaly detection instance cxr image fig patient pleural thickening top image fig air trapping bottom image fig address challenging case improve generalization capability deep-learning-based approach anomaly detection sophisticated algorithm method feature representation required along additional large-scale training datasets figure radiograph selected misclassified examples—the anomaly score generated proposed method showed best performance experiment truth label normal predicted label abnormal truth label abnormal predicted label normal full size image conclusion study proposed unsupervised anomaly detection method cxr image using multiresolution patch-based self-supervised learning proposed method leveraged patch image different resolution address problem related rigid partitioning input image patch fixed size furthermore self-supervised contrastive learning applied train feature extraction model patch image thereby producing discriminative deep feature representation related experiment conducted public dataset ass validity proposed method result show unlike single-resolution patch-based method proposed method performs consistently well regardless evaluation criterion thus demonstrating effectiveness utilizing multiresolution patch-based feature furthermore proposed method significantly outperformed state-of-the-art anomaly detection method future research area study investigate several pertinent aspect first plan study behavior proposed method changing core component image partitioning strategy contrastive learning algorithm second intend apply semi-supervised approach proposed method use labeled abnormal data improve performance in-depth investigation anomaly detection cxr could contribute improving refining proposed method positive implication radiology whole