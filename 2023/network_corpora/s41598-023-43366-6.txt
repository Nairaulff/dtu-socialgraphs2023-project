introduction roasted ground coffee matrix highly complex porous medium characterized multiscale feature typical coffee matrix used double-shot espresso brew volume consists million coffee particle coffee particle produced grinding roasted coffee bean approximately bimodal size distribution first peak distribution profile always around 30\sim 40\ representing so-called fine i.e. inner wall cellular fragment rigorous first peak preceded small submicron fraction second peak represents so-called coarses mean size depends grinder value ranging moreover coffee particle entirely solid porous material characterized many cell-pockets dimension 60\ inside particle finally cell-walls also porous nanoscale level coffee extraction water flow complex porous structure many chemical compound including among many others caffeine trigonelline polyphenols polysaccharide diffused convected solid matrix finally enter cup determine quality e.g flavour mouthfeel final beverage coffee extraction process especially difficult model simply complex topological feature related multiscale nature coffee bed geometry explained also many physical process concomitant simple diffusion convection example porous medium undergoes geometric change due fine migration particle erosion particle swelling also solubilization many hydrophilic substance emulsification insoluble coffee oil suspension solid coffee cell-wall fragment fine _2\ degassing supersaturation physical process interconnected rendering modelling coffee extraction challenging order predict coffee quality propose better brewing protocol priori many work tried model extraction process using variety simulation technique mention early attempt using cellular automaton based model percolation simulation recently lattice bolztmann method lbm also used simulate extraction kinetics consider swelling erosion effect multiscale model also proposed work moroney upscaling procedure applied relate conservation equation different scale developed multiscale model able quantitatively reproduce experimental extraction profile parameterized experimentally measured coffee bed parameter work melrose cameron another multiscale model incorporate bimodal characteristic coffee particle proposed model macroscopic mass transport modelled using 1-dimensional convection-diffusion equation microscopic extraction modelled diffusion equation inside representative coffee particle different layer coffee matrix equation different scale coupled source term boundary condition model also found able capture extraction kinetics besides model mesoscopic model based smoothed dissipative particle dynamic sdpd also recently proposed incorporate fine migration particle erosion swelling effect coffee extraction however aforementioned modelling simulation fluid dynamic coffee matrix either characterized average porosity permeability resolved flow artificial packing many spheres/disks simulation may able capture important feature coffee extraction example coffee particle size usually smooth bimodal distribution particle spherical therefore many detail lost simple carman-kozeny relation darcy law used characterize flow synthetic porous medium formed packing ideal spheres/disks used percolation simulation fact known particle size distribution quite influential final quality coffee therefore important accurately model whole spectrum particle size coffee extraction simulation straightforward high-resolution mapping—capturing microscopic detail coffee matrix—can obtained using x-ray microtomography microct microscopy xrm scan coffee matrix build porous medium model using 3d-reconstructured inner topology way full particle size distribution considered spatial permeability fluctuation matrix also captured spatial permeability fluctuation could correlate partially clogged phenomenon may cause fine coffee powder extraction rate x-ray microct also possible scan pre-extraction dry coffee matrix post-extraction wet coffee matrix comparison could reveal information porous structure change extraction process information could provide important guidance model different physical process lead geometric change matrix restructuring extraction far able determine microct reconstruction coffee matrix microstructure used direct coffee extraction simulation subject current article article use microct reconstructured data build static porous medium model simulate percolation process using smoothed particle hydrodynamics method sph determine simulated medium permeability different pressure gradient compare experimental data literature show inertial effect quite influential pressure gradient typically considered espresso brewing result inconsistency many result coffee matrix permeability found literature explained above-mentioned inertial effect several type coffee powder also examined permeability tortuosity measured systematically using sph simulation allows establish link coffee powder granulometry microstructural feature extraction efficiency finally microct image post-extraction coffee matrix also analyzed revealed decreasing porosity profile bottom-oulet top-inlet always develops extraction counterintuitive phenomenon explained using specific pressure-dependent erosion model proposed previous work article organized follows sect material method introduce coffee powder study sect coffee powder particle size analysis method sect particle size analysis microtomography techinique sect x-ray microtomography sph-based percolation simulation technique sect percolation simulation using sph sect result discussion powder granulometry first presented sect coffee powder granulometry show brief analysis microct image sect xray microct analysis discussion percolation tortuosity coffee matrix done sect permeability tortuosity analysis post-extraction microct image reported sect analysis post-extraction image finally conclusion drawn sect summary conclusion material method coffee powder four different type ground coffee obtained medium roasted coffea arabica blend used espresso type characterized typical size distribution traditional espresso brew preparation ipso type typical capsule espresso brew preparation refilly moka type typical moka-pot preparation pillowpack type typical drip-filter preparation case type dark roasting degree also used coffee powder packaged single dose capsule espresso brew iperespresso capsule single shot espresso approximately cylindrical around 14.6 height 32.5 width capsule contains 6.7±0.1 gram coffee powder capsule used experiment sent illycaffè s.p.a particle size analysis powder examined laser diffraction obtain particle size characteristic mastersizer malvern instrument used x-ray microtomography x-ray imaging used obtain internal microscopic structure coffee matrix zeiss xradia versa carl zeiss xrm pleasanton usa used carry high-resolution xrm non-destructive imaging achieved using ccd charge coupled device detector system scintillator-coupled visible light optic tungsten transmission target scan performed x-ray tube voltage tube current exposure ms. total projection collected objective lens giving optical magnification 0.4x selected binning set producing isotropic voxel three-dimensional pixel size around 16.8 16.8 16.8 tomograms reconstructed projection using zeiss microscopy commercial software package xmreconstructor automatically generated cone-beam reconstruction algorithm based filtered back-projection powder illy hyper espresso capsule see detailes segmentation acquired choosing global greyscale threshold binarise microct imaging however resolution microct scan order smaller fine fine occupying air space therefore greyscale air space actually function partial volume air fine furthermore coffee particle also many internal pore scale microct resolution grayscale coffee also function partial volume solid air inside coffee particle therefore quite challenging determine proper greyscale threshold distinguishing coffee air space moreover greyscale distribution microct imaging coffee bed unimodal gaussian shape conventional segmentation technique typically fails image determine greyscale threshold matching bed porosity microct imaging typical porosity value available literature procedure follows microct image inverted original image brighter pixel represent solid first invert value pixel assuming greyscale threshold known t_g\ microct imaging binarized using threshold connected-region labeling algorithm used identify connected isolated void cluster void consist one major cluster large volume many minor cluster small volume apparently major cluster represents inter-granular pore isolated minor cluster closed pore inside grain get bed porosity closed porosity total porosity volume cluster avoid dealing cylindrical surface coffee cake extract cuboid 600\times 600\times voxels 1\times 1\times microct imaging coffee cake varying t_g\ porosity cuboid sample different threshold determined example obtained processing microct imaging type powder shown fig seen figure total porosity almost bed porosity total volume intergranular pore also order higher intragranular closed pore indicating closed pore captured microct imaging reasonable since resolution microct imaging 16.759\ voxel intragranular pore scale resolution high enough accurately capture intragranular pore therefore porosity consists overwhelmingly bed porosity coffee cake matching bed porosity obtained binarized image typical bed porosity coffee matrix available literature determine correct grayscale threshold use threshold binarize microct imaging example presented fig porosity matched 0.17 grayscale threshold determined grayscale threshold used binarize microct image figure bed porosity total porosity cuboid sample different grayscale threshold dash black line mark typical bed porosity realistic coffee matrix volume intergranular pore intragranular closed pore different grayscale threshold full size image percolation simulation using sph segmentation label matrix voxel model solid voxels labelled void/air voxels labeled simulation use smoothed particle hydrodynamics sph method see supplementary material simulation box specified size filled sph particle specified number density lattice form mapping simulation box 3-d region inside voxel model label matrix interpolated classify sph particle fluid particle solid particle construction sph particle model microct imaging finished classification example sph particle model generated procedure shown fig example cube length 708\ extracted microct imaging used procedure buffer fluid region top bottom added sph particle density specified number density voxels particle face-centered cubic lattice point figure example sph particle model l_x l_z l_y=991 blue particle solid grain red particle fluid full size image sph particle model ready set periodic boundary condition boundary applied body force direction drive fluid percolate porous medium reader referred supplementary material detail sph formalism sph parameter used simulation result discussion coffee powder granulometry figure density distribution particle size different type ground coffee cumulative distribution particle size full size image particle distribution coffee powder measured laser diffraction shown fig density distribution typically bimodal first peak representing fine particle second peak coarse particle first peak always around 25\sim fine cell fragment cell size range 25\sim position coarse peak shift right coarser grind result laser diffraction measurement including uniformity specific surface area sauter diameter 3,2 brouckere mean diameter 4,3 volume fraction particle summarised table seen fig table type type volume fraction fine decreasing assume particle smaller fine 29.21 fine type powder 9.7 fine type powder mean diameter also increase type type uniformity specific surface area decrease concomitantly table result laser diffraction different type coffee powder full size table xray microct analysis figure vertically-cut section microct imaging type coffee powder full size image vertical digital section microct/xrm imaging data type powder shown fig enlarged cutting section image powder provided supplementary material coffee grain plastic/metal structure skeleton capsule clearly visible image microct imaging first binarised following segmentation protocol introduced show cropped section microct imaging segmentation fig note figure image segmentation already pixel inverted brighter region represent void seen image coffee grain becoming coarser coarser type type agreement particle size measurement figure cropped horizontally-cut section microct imaging segmentation type powder type powder type powder type powder first column show original microct image second column show histogram grayscale red line mark grayscale threshold determined matching bed porosity third column show thresholded image full size image binarised image used analyse spatial distribution porosity coffee cake coffee cake cylinder shape divide cake many annular section radial thickness calculate volume fraction void vertical layer variation curve porosity vertical coordinate different radial distance centre acquired shown fig seen decreasing volume fraction fine curve fluctuates significantly capsule porosity relatively homogenous across matrix case significant variation trend radial direction except type capsule apparent trend higher porosity near top center could result different transportation condition capsule case significant variation trend vertical direction figure local porosity coffee cake different position vertical position radial distance center cake type type type type full size image permeability tortuosity figure flow rate different pressure gradient fit using darcy law pressure gradient relatively low type powder full size image start investigate permeability type powder detail porous flow simulated sph cropped cubic sample length first examined sph particle model shown fig fluid buffer region total height buf =283 added direction body force applied -y\ direction effective pressure gradient sample region 1+l_ buf figure show relation effective pressure gradient resultant flow rate -y\ direction relation linear fit using darcy law aligned -\frac aligned give permeability k=5.51\times 10^ -13 m^2 value smaller measurement gianino 2.3\times 10^ -12 ^2\ king 8.98\times 10^ -13 ^2\ larger estimation given navarini k=0.7\sim 4\times 10^ -13 m^2 corrochano 2.59\times 10^ -14 3.36\times 10^ -13 m^2 disagreement probably caused different overpressure across coffee bed gianino king experiment overpressure order 0.01\ bar experiment navarini corrochano overpressure order bar sph model fig pressure gradient 8\sim 40\ bar/m represents overpressure 0.16\ bar 0.8\ bar coffee bed height overpressure intermidiate resulting permeability higher navarini corrochano pressure gradient significantly increased shown fig permeability obtained using darcy law decrease increasing pressure head achieving better agreement navarini corrochano result fig overpressure 1\sim bar pressure gradient increase 50\ bar/m 400\ bar/m coffee bed height considered increase pressure head permeability decrease 5.2\times 10^ -13 2.5\times 10^ -13 m^2 kind pressure dependence also reported navarini experimental investigation experiment dependence permeability pressure gradient might attributed deformation bed pressure simulation porous coffee bed static deformable dependence still observed dependence attributed deformation porous bed pressure believe permeability decrease higher pressure result flow inertial effect fig flow rate different pressure gradient fit using darcy law forchheimer modification presented aligned -\frac q-\frac k_1 aligned fit good give permeability k=8.0\times 10^ -13 m^2 additional inertial permeability k_1=2.17\times 10^ -13 m^2 inertial effect cause flow rate increase rate slower linear relation darcy law used give permeability decreasing increasing pressure gradient use 4,3 =341.6\ characteristic length reynolds number =d_ 4,3 q/\mu\ fig 0.84 3.86 indicating inertia indeed important high pressure gradient figure pressure gradient relatively high permeability obtained darcy law dependent pressure gradient flow rate different pressure gradient fit using darcy law forchheimer modification type powder full size image assuming recirculation tortuosity excerpt coffee bed sample determined tracing trajectory fluid particle aligned _i\in _i|| _i\in ^\beta _i\right| aligned tortuosity total fluid particle _c\ coffee sample domain _i\ trajectory particle direction filtration one simulation fig trajectory labeled particle whose initial position top upper buffer fluid region shown fig boundary periodic coordinate unwrapped trajectory span outside simulation box using tortuosity determined 1.80\ power law relationship frequently used describe tortuosity-porosity correlation aligned aligned parameter dependent packing property porosity sample known 0.17 using determined -\log 0.33\ figure trajectory fluid particle coffee bed sample arrow mark direction pressure gradient black frame simulation box dimension l_x l_z l_y=991 boundary periodic coordinate unwrapped type powder full size image result shown obtained small sample whole coffee bed bed however quite inhomogenous porosity vary significantly across whole bed radial axial direction shown fig therefore properly characterize property coffee bed extract sample bed perform simulation result location sample summarized table fig fig discharge–pressure gradient relation different sample fitted using darcy law forchheimer modification low regime relatively higher regime respectively sample show significant deviation darcy law relatively high regime forchheimer formula accurately capture q-\nabla relationship high regime note fig transition darcy forchheimer correspond one single critical reynolds number phenomenon also reported researcher field hydrology coarser particle lead higher critical permeability obtained using darcy law low regime presented table permeability obtained using forchheimer modification relatively high regime presented tab _1\ inertia permeability porosity tortuosity sample also presented table seen porosity tortuosity fluctuate slightly strong correlation porosity measured higher porosity tends lead larger table summary property coffee sample type powder full size table figure discharge different pressure gradient different excerpt coffee sample dash line fitting using darcy law solid line fitting forchheimer formula type powder full size image percolation simulation also run sample type powder result summarized table permeability k^d\ different type powder low pressure gradient also shown fig seen coffee particle becoming coarser average permeability increase variance permeability also increase table summary property coffee sample type powder full size table table summary property coffee sample type powder full size table table summary property coffee sample type powder full size table figure permeability different powder full size image result presented see variance permeability across bed quite large despite trend average value permeability see fig agreement qualitative prediction based coarseness coffee particle fine larger specific surface area smaller permeability even though small number sample used analysis different powder still able show qualitative difference given enough computation resource quantitative comparison extraction dynamic different powder possible analysis post-extraction image order study link changing microstructure extraction two additional illy iperespresso capsule extracted post-extraction microct imaging analysed capsule extracted using x7.1 iperespresso capsule coffee machine water temperature 3^\circ\ pressure 13\pm bar capsule scanned microct extraction comparison made investigate morphological change caused extraction know porosity extracted coffee cake priori segmentation threshold determined matching porosity however since wetting distinction coffee grain intergranular pore much significant manually select grayscale threshold capture phase boundary example microct imaging extracted dark roast capsule shown fig seen boundary grain void much clearer fig figure also show distribution grayscale microct image bimodal therefore select threshold manually binarise microct image choose threshold horizontal center two distribution peak threshold selected way make segmentation least sensitive threshold value segmentation result fig shown fig figure original microct image type dark roast powder extraction histogram grayscale pixel red line mark manually-selected grayscale threshold thresholded image full size image capsule type medium roast powder capsule type dark roast powder scanned extraction comparison binarized microct image extraction shown fig comparison porosity extraction presented fig seen capsule extraction coffee cake become porous porosity decrease significantly wetting coffee grain swell stick neighbour liquid fill intragranular pore also lot intergranular pore microct properly distinguish liquid phase solid phase resulting underestimation porosity however focus relative spatial porosity variation coffee cake rather absolute porosity value fig porosity type medium roast powder extraction day extraction shown extraction porosity relatively homogenous opposite day extraction porosity top center becomes much larger region matrix probably due drying matrix i.e drying faster top center however region away center porosity always larger bottom outlet top inlet phenomenon counterintuitive since would expect gravity drive residual water fragment bottom making lower part matrix porous extraction applied external pressure also consolidated matrix efficiently bottom surprisingly extraction observe larger porosity lower part outlet upper part inlet exclude effect drying fig porosity type dark roast powder extraction right extraction shown without complexity induced drying process see clearly porosity always higher bottom extraction experiment performed post-extraction matrix scanned extraction confirm porosity profile always apparent decreasing trend bottom top matrix besides drying process consolidation physical process could also affect geometry matrix fragment migration grain swelling prior work modelled fine migration particle swelling using sph fine migration tend lead lower porosity near bottom filter bottom prevents fine leaving capsule hand swelling process initiated earlier top cause matrix porous top indeed case since water infused top bottom however difference porosity caused effect expected minor extraction infusion process fast 1\rm swelling process grain eventually saturate min still see porosity difference extraction probable cause observed spatial porosity distribution heterogenous erosion process scanning electron microscopy observation shown immersed coffee grain gas entrapped coffee particle fully wetted extraction due abundant gas entrapped intra-grain pore therefore part coffee particle remain dry brittle extraction process brittle material failure criterion usually pressure-dependent note pressure also quite non-uniform coffee matrix result filtration process heterogeneity post-extraction porosity probably correlated pressure drop across matrix pressure-dependent failure criterion eroding material matter fact previous numerical simulation study propose bottom-up mesoscopic erosion model framework sph incorporates mohr-coulomb yield criterion simple shear-erosion model simulation using model show heterogeneity filtration direction doe occur result pressure-dependent erosion initially relatively uniform porosity distribution becomes highly non-uniform filtration higher porosity bottom flow outlet lower porosity top flow inlet non-uniformity mainly controlled internal friction angle eroding material post-extraction porosity profile reported qualitative agreement prediction erosion model suggests proposed model suitable capture special characteristic coffee cake erosion figure thresholded microct image type medium roast powder extraction day extraction full size image figure porosity type medium roast powder extraction day extraction full size image figure thresholded microct image type dark roast powder extraction right extraction full size image figure porosity type dark roast powder extraction right extraction full size image summary conclusion summarize use high-resolution x-ray microct technique capture microscopic detail coffee matrix particle-level reconstructured data used build sph-based digital twin percolation process explore link microstructure flow property two perspective permeability tortuosity using microct reconstruction data combined sph percolation simulation permeability tortuorsity matrix determined found inertial effect actually quite significant normal pressure gradient espresso brewing report literature showing larger pressure gradient seems lead lower coffee matrix permeability demonstrate explained considering inertial effect also examine several type coffee powder permeability tortuosity measured systematically using sph simulation result show variance permeability different location matrix quite large coarser powder larger variance despite average permeability steadily increase powder becomes coarser post-extraction microstructure analyzed microct image post-extraction coffee matrix found decreasing porosity profile bottom outlet top inlet always develops extraction counterintuitive phenomenon explained using pressure-dependent erosion model proposed prior paper suggested erosion coffee powder extent pressure-dependent pressure-dependence probably originates gas entrapped inside coffee particle grain fully wetted remain sufficiently brittle failure brittle material usually pressure dependent another physical scenario consistent pressure-dependent erosion model connected presence individual fine adhering electrostatically coarse particle removed flow superficial attraction force overcome hydrodynamic normal-tangential force summarize using microct sph simulation obtained two key finding including identification darcy-forchheimer transition heterogeneous porosity profile filtration direction extraction darcy-forchheimer transition suggests decrease permeability higher extraction pressure found many experiment attributed inertial effect help clarify discrepancy experiment different research group provides guidance new measurement experiment post-extraction heterogeneity filtration direction indicates erosion coffee particle pressure-dependent highlight role played erosion mechanism coffee grain hydrodynamic force mainly explored link microstructure obtained microct flow property qualitative way constrained computational resource model full realistic size simulated establish quantitative link nevertheless result show microct scan provide many microscopic detail coffee matrix information critical want accurately model percolation process moreover comparing pre- post-extraction scan obtain crucial information geometry change extraction process turn reveal detail interconnected complex physical process develop coffee extraction help propose better modelling method account process