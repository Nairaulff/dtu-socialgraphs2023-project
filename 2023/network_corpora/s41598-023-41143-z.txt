introduction outpatient program effective substance use disorder sud treatment particularly detoxification needed completed continuous monitoring longer needed treatment often successful client remain program day program exited medical advice earlier recommended due administrative reason due extended incarceration yet also know substantial variation treatment completion due individual difference e.g. race age drug choice social difference e.g. employment housing disruption thus research needed combination i.e. intersection described factor often lead positive outcome well-known specific situation client likely remain successfully complete outpatient sud treatment guideline exist many guideline focus medical and/or mental health management evaluate impact outcome associated interaction individual social characteristic address challenge emerging work started identify nuanced condition associated treatment success machine learning based work found recent frequency substance use self-motivation significant predictor treatment completion well work identified general disparity associated treatment completion sud outpatient provider one source data study focus treating whole person i.e. individual well social support need rather symptom issue associated directly substance use however yet sufficiently understand individual social characteristic interact predicting treatment completion especially priority assistance population including minority population enough known factor beneficial treatment completion address open question regarding individual social factor interact toward affecting treatment success situate study domain intersectionality theory intersectionality theory focus determinant especially demographic social determinant interact evaluating cause effect body work assumes determinant often intertwine impacting effect opposed individual isolated impact thus apply contribute theory two way identifying intersectionality individual social determinant sud outpatient treatment context study furthering application virtual twin method identifying true intersection variable rather additive stepwise approach noted ideal identifying intersection thus conducted study partnership outpatient sud treatment program determine factor combination impact preferred outcome population client primarily african american male residing southeastern u.s. applied ml—specifically virtual twin includes prediction feature importance classification tree-based subgroup analysis—to determine factor combination level predictive longer lengths-of-stay treatment day successful treatment completion leave medical advice reason extended incarceration ultimately find population best predictor treatment success number self-help group attended treatment followed number goal set client analyzing subgroup client likely attend least one self-help group likely set one goal find access primary care provider pcp supplemental nutrition assistance program snap enhance probability engaging beneficial activity i.e. self-help group attendance goal setting also find several additional subgroup nuance reported later finding used sud treatment provider determine best prioritize myriad client guidance support recommendation service available method research design observational prognostic quality improvement study conducted august may using de-identified client data outpatient sud treatment program southeastern region u.s georgia state university gsu institutional review board irb approved study exempt due data de-identified thus requiring informed consent irb number h22253 reference number method performed accordance relevant guideline regulation study followed transparent reporting multivariable prediction model individual prognosis diagnosis tripod guideline first stage predictive model study also followed standard quality improvement reporting excellence squire guideline second stage method applies classification tree toward fully understanding impact outcome data source de-identified data census client utilized outpatient sud treatment service provided one sud treatment program southeast region u.s. purpose better understanding predictor longer stay day successful treatment completion stayed treatment deemed completed clinician leave medical advice reason data collection required examination electronic paper record well chart review final data also lagged number month chart paperwork completed data greater one year old also note many study domain make use treatment episode data set ted available substance abuse mental health service administration samhsa data breadth advantage especially contain many million row representing admission discharge throughout country lack detailed variable regard client choice social determinant therefore acknowledge sample limited specific region client population single provider treatment service dataset unique advantage including detailed client choice social determinant thus study reported unique applied emerging method virtual twin narrow sample benefit specific variable used study sud treatment target variable outcome considered study used two target variable consistent dependent target variable used sud treatment research day length-of-stay coded day day successful treatment completion coded left medical advice administrative reason extended incarceration discharged successfully completed treatment note asked treatment provider discharge coded zero i.e. completed successfully reason moving death transfer incarceration responded none client ever moved area receiving treatment died treatment small percentage needed transferred higher-level facility administratively discharged due extended incarceration thus nearly discharge coded zero i.e. completed successfully due leaving medical advice note chose use dichotomous variable first stage dependent target variable three reason sud treatment provider working interested factor contributed day length stay one metric success also substantiated literature i.e. day treatment often lead better outcome day application virtual twin literature within similar research context also used dichotomous variable first stage classification opposed regression best fit view first stage true output model reported second stage decision tree attempting predict precise los i.e. dichotomized seemed applicable classification specified facility predictor variable variable provided include substance use information history e.g. primary secondary substance use prior use substance demographic e.g. race gender age marital status education medical detail history e.g. mental health diagnosis prescription medication linked primary care provider social determinant e.g. access transportation linked snap employment/income client choice e.g. number goal set number self-help group attended relevant information e.g. referral source criminal system involvement admission outcome length stay discharge status variable provided target variable day length stay discharge status leaving variable use prediction variable included prediction model see supplement descriptive statistic include full variable list two variable setting goal attending self-help group explained become important result regarding setting goal goal always set face-to-face counselor individual supported developing specific measurable achievable relevant timely smart goal utilizing worksheet required identifying documenting time revising stated goal ensure smart process also included discussion documenting goal important individual benefit achieving goal potential obstacle solution specific action step well identifying people would supportive helpful process working toward goal individual typically created goal based following domain psychiatric includes substance use/abuse mental health goal housing/living family/social work/education regarding self-help group attendance alcoholic anonymous narcotic anonymous designed help individual recovering substance abuse addiction group individual required participate part treatment program addition two group individual also participated christian-based recovery program designed help individual struggling wide range hurt habit hang-up including limited addiction trauma grief anxiety relationship issue machine learning approach applied virtual twin developing prediction model helpful understanding likely remain treatment day successfully complete treatment prediction model often opaque goal often high accuracy rather explanation transparency one way open black box prediction model apply subgroup analysis particularly classification tree however also well known classification tree prone overfitting address dual challenge explaining certain outcome likely also avoiding overfitting extent possible new method developed including virtual twin method virtual twin method based use counterfactuals two possibility one observed method designed first estimate difference probability observed counterfactual i.e. client represents treated group i.e. subgroup represents control group i.e. subgroup second stage method designed determine variable cause probability difference modeling impact covariates predictor probability difference specifically first stage probability determined outcome every observation subgroup variable represents observed establish counterfactual virtual twin second probability calculated every observation subgroup variable i.e. whether goal set client whether self-help group attended client switched opposite i.e. least one goal set switched vice versa process self-help group attendance difference two probability calculated per observation e.g. one goal set goal set one self-help group attended self-help group attended difference becomes target variable second stage second stage applied classification tree determine factor predictor variable first stage subgroup variable cause probability difference result client characteristic sample black african american 87.9 aged 41–60 70.7 single 85.2 completed grade higher 74.7 primarily used alcohol 37.9 cocaine 43.4 court ordered participate 80.5 criminal system involvement time admission 52.3 receiving snap intake 77.3 already primary care provider pcp intake 78.1 linked pcp treatment 68.4 secondary mental health diagnosis 71.9 regarding outcome 57.8 stayed longer day prior discharge 44.9 discharged advice clinician i.e. successfully completed treatment detail additional descriptive statistic please see supplement virtual twin stage performance result first step first stage develop prediction model two target variable day successful treatment completion target variable logistic regression gradient boosting random forest deep learning method applied prediction every application method i.e. logistic regression gradient boosting random forest deep learning tenfold cross validation applied training testing data split day target variable prediction model accuracy ranged 0.731 gradient boosting 0.751 logistic regression auc ranged 0.748 deep learning 0.782 random forest given comprehensiveness auc score selected model highest auc score prediction random forest model see supplement detail note auc score represent area receiving operator characteristic curve roc area curve plotted true positive true negative rate every classification threshold zero one model evaluated integral roc curve result single number represents area curve i.e. auc range auc larger value accurate prediction closer prediction accuracy i.e. true positive true negative rate closer percent accurate auc score shown good overall metric evaluating model thus used auc score evaluation metric prediction accuracy successful treatment completion target variable prediction model accuracy ranged 0.797 deep learning 0.831 gradient boosting random forest auc score ranged 0.841 deep learning 0.886 random forest consistent across model selection procedure selected model highest auc coincidently random forest model see supplement detail ran feature importance random forest prediction model i.e. day successful treatment completion prediction model feature importance method return scaled result important followed variable lesser importance case important two variable number self-help group attended treatment scaled score feature importance result number goal set client scaled score 0.85 day model 0.69 treatment completion model see fig detail top important feature figure feature importance virtual twin stage random forest prediction model feature importance scaled important full size image virtual twin stage result second stage classification tree used determine combination predictor variable level least impact difference probability selected subgroup variable study applying method utilize predetermined subgroup variable e.g. race explore number possible subgroup e.g. race also co-occurrence mental health disorder income job health insurance access gender age veteran status primary substance choice opted define subgroup result feature importance first stage word sought explanation predictor important predicting selected outcome day successful treatment completion also subgroup likely engage behavior beneficial suggested duration day completion thus selected top two important feature stage 1—number self-help group attended number goal set— stage analysis happened consistent two prediction model i.e. day successful treatment completion thus variable selected analysis self-help group attended vs. one self-help group attended goal set vs. one goal set generated two classification tree per prediction model one self-help group analysis one goal set analysis word day prediction model classification tree generated self-help subgroup virtual twin probability difference fig number goal set virtual twin subgroup probability difference fig treatment completion prediction model classification tree generated two subgroup self-help subgroup virtual twin probability difference fig number goal set subgroup virtual twin probability difference fig figure virtual twin stage classification tree result client stayed treatment day attended one self-help group session treatment node show two number top number increased decreased probability staying day attending self-help group bottom number percent sample node applies branch represent split sample left branch represent branching condition met yes right branch represent branching condition met hue node darker percentage impact top number higher thus darkest node greatest impact lightest least full size image figure virtual twin stage classification tree result client stayed treatment day set one treatment goal node show two number top number increased decreased probability staying day setting goal bottom number percent sample node applies branch represent split sample left branch represent branching condition met yes right branch represent branching condition met hue node darker percentage impact top number higher thus darkest node greatest impact lightest least full size image figure virtual twin stage classification tree result client successfully completed treatment attended one self-help group session treatment node show two number top number increased decreased probability completing treatment successfully i.e. discharged clinician rather medical advice attending self-help group bottom number percent sample node applies branch represent split sample left branch represent branching condition met yes right branch represent branching condition met hue node darker percentage impact top number higher thus darkest node greatest impact lightest least full size image figure virtual twin stage classification tree result client successfully completed treatment set one treatment goal node show two number top number increased decreased probability completing treatment successfully i.e. discharged clinician rather medical advice setting goal bottom number percent sample node applies branch represent split sample left branch represent branching condition met yes right branch represent branching condition met hue node darker percentage impact top number higher thus darkest node greatest impact lightest least full size image result stayed day self help group attendance vs. result show using day prediction model client influenced attend self-help group criminal system involvement white race likely representing sample followed closely criminal system involvement set 2.5 4.5 goal likely representing sample result stayed day number goal set vs. result show using day prediction model client influenced set goal linked pcp treatment i.e. branch linked pcp equal false prescribed medication homeless shelter 8.3 likely representing sample note result confusing interpret due value variable yes branching condition yes also note tree relatively deep leading specific perhaps generalizable result one way address evaluate node higher level tree i.e. closer root node rather final leaf i.e. node bottom note client 5.8 likely set least one goal linked pcp treatment representing sample thus important generalizable takeaway pcp beneficial condition result discharge successfully completed self help group attendance vs. focus main takeaway rather complexity bottom leaf node result show using treatment completion prediction model client influenced attend one self-help group linked snap health insurance admission established support system set 2.5 goal likely representing sample result discharge successfully completed number goal set vs. result show using treatment completion prediction model client influenced set one goal attended 5.5 self-help group treatment completed grade college higher dual diagnosis including mental health disease likely representing sample discussion better understand intersecting factor associated staying outpatient sud treatment day well factor associated treatment completion success applied virtual twin method analyze discharge client one treatment program southeast region u.s. first found attending one self-help group setting one goal predictive success staying day completing treatment successfully subsequently analyzed factor contributing probability difference observed counterfactual outcome day successful treatment completion two important feature self-help group attendance setting goal several nuance classification tree finding primary result follows variable treatment program influence i.e. variable client criminal system involvement good know changed impacted treatment program linked pcp help client attend self-help group often thus stay program day linked snap help client attend self-help group associated higher probability completing treatment successfully attending self-help group session associated setting goal ultimately increase probability client successfully completing treatment thus overall primary predictor success attending self-help group setting goal ideally 2.5 goal secondary predictor linked pcp linked snap attending self-help group session prior research substance use disorder treatment completion found factor employed attending support group court ordered attend fewer adverse childhood experience primary factor predicting treatment completion higher education mental health need also primary determinant factor age race drug choice moderate effect missing in-depth analysis intersection individual social determinant particularly using data method well suited identifying heterogeneity within individual social variable prior application virtual twin method focused prescribed characteristic i.e. race yet let feature importance drive factor considered virtual twin model therefore contribute evaluating individual social intersection two target variable identified via feature importance top driver success day los treatment completion using virtual twin method believe approach applied additional client population receiving treatment provider region better understand intersection vary provider region client circumstance particular seeking treat whole person prioritization needed considering many individual social factor could considered thus study help provider either apply method data understand priority may and/or client population similar apply priority identified providing treatment regard limitation study benefit high quality in-depth data several variable represent client choice e.g. number self-help group attended number goal set social determinant e.g. pcp linkage snap linkage access transportation social support system etc study sample specific treatment program i.e. one provider outpatient service one geographic location result reported representative highest probability success sample research needed determine similar probability increase found sample population especially promising application toward better understanding intersection exciting opportunity future research area conclusion study identified primary secondary factor associated length-of-stay treatment success finding suggest client choice social determinant access primary care play role treatment success contribute overall literature mental health trend quality improvement